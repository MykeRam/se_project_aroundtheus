(()=>{"use strict";class e{constructor(e,t,r,s,i){this._name=e.name,this._link=e.link,this._id=e._id,this._isLiked=e.isLiked,this._templateSelector=t,this._handleImageClick=r,this._handleLikeClick=s,this._handleDeleteClick=i}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".card").cloneNode(!0)}_setEventListeners(){this._likeButton.addEventListener("click",()=>{this._handleLikeClick(this._id,this._isLiked).then(e=>{this._isLiked=e.isLiked,this._renderLikeState()}).catch(e=>console.error("Like error:",e))}),this._deleteButton.addEventListener("click",()=>{this._handleDeleteClick(this._id)}),this._cardImage.addEventListener("click",()=>{this._handleImageClick(this._link,this._name)})}_renderLikeState(){this._likeButton.classList.toggle("card__like-button_active",this._isLiked)}removeCard(){this._element.remove(),this._element=null}generateCard(){return this._element=this._getTemplate(),this._cardImage=this._element.querySelector(".card__image"),this._likeButton=this._element.querySelector(".card__like-button"),this._deleteButton=this._element.querySelector(".card__delete-button"),this._cardImage.src=this._link,this._cardImage.alt=this._name,this._element.querySelector(".card__title").textContent=this._name,this._renderLikeState(),this._setEventListeners(),this._element}}class t{constructor(e,t){this._formElement=t,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}_showInputError(e,t){const r=this._formElement.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),r.textContent=t,r.classList.add(this._errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(){return this._inputList.some(e=>!e.validity.valid)}_toggleButtonState(){this._hasInvalidInput()?this.disableSubmitButton():(this._buttonElement.disabled=!1,this._buttonElement.classList.remove(this._inactiveButtonClass))}_setEventListeners(){this._toggleButtonState(),this._inputList.forEach(e=>{e.addEventListener("input",()=>{this._checkInputValidity(e),this._toggleButtonState()})})}enableValidation(){this._formElement.addEventListener("submit",e=>{e.preventDefault()}),this._setEventListeners()}disableSubmitButton(){this._buttonElement.disabled=!0,this._buttonElement.classList.add(this._inactiveButtonClass)}resetValidation(){this._inputList.forEach(e=>{this._hideInputError(e)}),this.disableSubmitButton()}}class r{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.addEventListener("mousedown",e=>{e.target===e.currentTarget&&this.close(),e.target.classList.contains("modal__close")&&this.close()})}}class s extends r{constructor(e,t){super(e),this._handleFormSubmit=t,this._form=this._popup.querySelector(".modal__form"),this._inputList=Array.from(this._form.querySelectorAll(".modal__input")),this._submitButton=this._form.querySelector(".modal__button"),this._defaultButtonText=this._submitButton.textContent}_getInputValues(){const e={};return this._inputList.forEach(t=>{e[t.name]=t.value}),e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())})}renderLoading(e,t="Saving..."){this._submitButton.textContent=e?t:this._defaultButtonText}close(){super.close(),this._form.reset()}}const i=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}_request(e,t={}){return fetch(`${this._baseUrl}${e}`,{headers:this._headers,...t}).then(this._checkResponse)}getUserInfo(){return this._request("/users/me")}getInitialCards(){return this._request("/cards")}updateUserInfo({name:e,about:t}){return this._request("/users/me",{method:"PATCH",body:JSON.stringify({name:e,about:t})})}updateAvatar({avatar:e}){return this._request("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e})})}addCard({name:e,link:t}){return this._request("/cards",{method:"POST",body:JSON.stringify({name:e,link:t})})}deleteCard(e){return this._request(`/cards/${e}`,{method:"DELETE"})}likeCard(e){return this._request(`/cards/${e}/likes`,{method:"PUT"})}dislikeCard(e){return this._request(`/cards/${e}/likes`,{method:"DELETE"})}getAppInfo(){return Promise.all([this.getUserInfo(),this.getInitialCards()])}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"a3eb5cba-124c-47ee-af00-efa63d1e94e7","Content-Type":"application/json"}}),n={};var o;o={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},Array.from(document.querySelectorAll(o.formSelector)).forEach(e=>{const r=new t(o,e),s=e.getAttribute("name");n[s]=r,r.enableValidation()});const a=new class{constructor({nameSelector:e,jobSelector:t,avatarSelector:r}){this._nameElement=document.querySelector(e),this._jobElement=document.querySelector(t),this._avatarElement=document.querySelector(r)}getUserInfo(){return{name:this._nameElement.textContent,job:this._jobElement.textContent}}setUserInfo({name:e,job:t}){this._nameElement.textContent=e,this._jobElement.textContent=t}setUserAvatar(e){this._avatarElement.src=e}}({nameSelector:".profile__title",jobSelector:".profile__description",avatarSelector:".profile__image"}),l=new class extends r{constructor(e){super(e),this._image=this._popup.querySelector(".card__image_preview"),this._caption=this._popup.querySelector(".modal__caption")}open({name:e,link:t}){this._image.src=t,this._image.alt=e,this._caption.textContent=e,super.open()}}("#modal_type-preview");function d(e,t){l.open({name:t,link:e})}l.setEventListeners();const c=new class extends r{constructor(e){super(e),this._form=this._popup.querySelector(".modal__form")}setSubmitAction(e){this._handleSubmit=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",e=>{e.preventDefault(),this._handleSubmit()})}}("#delete-confirm-modal");function u(t){const r=new e(t,"#card-template",d,(e,t)=>t?i.dislikeCard(e):i.likeCard(e),e=>{c.open(),c.setSubmitAction(()=>{i.deleteCard(e).then(()=>{r.removeCard(),c.close()}).catch(e=>console.error("Delete error:",e))})});return r.generateCard()}c.setEventListeners();const _=new class{constructor({renderer:e},t){this._renderer=e,this._container=document.querySelector(t)}renderItems(e){e.forEach(e=>this._renderer(e))}addItem(e){this._container.prepend(e)}}({renderer:e=>{const t=u(e);_.addItem(t)}},".cards__list");i.getAppInfo().then(([e,t])=>{a.setUserInfo({name:e.name,job:e.about}),a.setUserAvatar(e.avatar),_.renderItems(t)}).catch(e=>console.error("APP INFO ERROR:",e));const h=new s("#profile-edit-modal",e=>{h.renderLoading(!0),i.updateUserInfo({name:e.title,about:e.description}).then(e=>{a.setUserInfo({name:e.name,job:e.about}),h.close(),n["profile-form"].disableSubmitButton()}).catch(e=>console.error("Profile update error:",e)).finally(()=>{h.renderLoading(!1)})});h.setEventListeners();const m=new s("#add-card-modal",e=>{m.renderLoading(!0),i.addCard({name:e.title,link:e.url}).then(e=>{const t=u(e);_.addItem(t),m.close(),n["card-form"].disableSubmitButton()}).catch(e=>console.error("Add card error:",e)).finally(()=>m.renderLoading(!1))});m.setEventListeners();const p=new s("#avatar-edit-modal",e=>{p.renderLoading(!0),i.updateAvatar({avatar:e.avatar}).then(e=>{a.setUserAvatar(e.avatar),p.close(),n["avatar-form"].disableSubmitButton()}).catch(e=>console.error("Avatar update error:",e)).finally(()=>p.renderLoading(!1))});p.setEventListeners();const v=document.querySelector("#profile-edit-button"),E=document.querySelector(".profile__add-button");document.querySelector(".profile__avatar-edit").addEventListener("click",()=>{n["avatar-form"].resetValidation(),p.open()}),v.addEventListener("click",()=>{const e=a.getUserInfo(),t=document.querySelector("#profile-edit-modal .modal__form");t.querySelector(".modal__input_type_name").value=e.name,t.querySelector(".modal__input_type_description").value=e.job,n["profile-form"].resetValidation(),h.open()}),E.addEventListener("click",()=>{n["card-form"].resetValidation(),m.open()})})();